<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Price Comparison MVP</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .best-deal { border: 2px solid #22c55e; }
  </style>
</head>
<body class="bg-white text-gray-800">

<div class="max-w-5xl mx-auto p-6">
  <h1 class="text-3xl font-bold mb-6 text-center">Price Comparison</h1>
  <div class="mb-6 flex justify-center">
    <input id="searchInput" type="text" placeholder="Search products..." 
           class="border rounded-lg p-2 w-full max-w-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400">
  </div>
  <div id="products" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
</div>

<script>
const searchInput = document.getElementById('searchInput');
const productsDiv = document.getElementById('products');

const logoMap = {
  'Amazon': 'https://upload.wikimedia.org/wikipedia/commons/a/a9/Amazon_logo.svg',
  'eBay': 'https://upload.wikimedia.org/wikipedia/commons/1/1b/EBay_logo.svg',
  'Walmart': 'https://upload.wikimedia.org/wikipedia/commons/c/ca/Walmart_logo.svg',
  'AliExpress': 'https://upload.wikimedia.org/wikipedia/commons/6/69/AliExpress_logo.svg'
};

async function searchProducts(query) {
  // Your backend URL is already inserted here
  const res = await fetch('https://price-compare-backend.onrender.com/search?q=' + query);
  const data = await res.json();
  displayProducts(data);
}

function displayProducts(products) {
  productsDiv.innerHTML = '';
  if (products.length === 0) {
    productsDiv.innerHTML = '<p class="col-span-full text-center text-gray-500">No products found.</p>';
    return;
  }

  products.forEach((p, index) => {
    const logo = logoMap[p.source] || '';
    const card = document.createElement('div');
    card.className = 'border rounded-lg shadow hover:shadow-xl transition transform hover:-translate-y-1 p-4 flex flex-col relative';
    
    const badgeHTML = index === 0 
      ? `<span class="absolute top-2 right-2 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded">Best Deal</span>` 
      : '';
    if(index === 0) card.classList.add('best-deal');

    card.innerHTML = `
      ${badgeHTML}
      <img src="${p.image}" class="w-full h-48 object-contain mb-4 rounded transition-transform transform hover:scale-105">
      <h2 class="font-semibold text-lg mb-2">${p.title}</h2>
      <div class="flex items-center justify-between mb-4">
        <span class="text-blue-700 font-bold text-xl">$${p.price.toFixed(2)}</span>
        ${logo ? `<img src="${logo}" class="w-8 h-8 object-contain">` : ''}
      </div>
      <a href="${p.link}" target="_blank" 
         class="bg-gray-300 hover:bg-gray-400 hover:scale-105 transition transform text-gray-900 font-bold py-2 rounded text-center">Buy Now</a>
    `;
    productsDiv.appendChild(card);
  });
}

searchInput.addEventListener('input', () => {
  const query = searchInput.value.trim();
  if (query.length > 0) searchProducts(query);
  else productsDiv.innerHTML = '';
});
</script>

</body>
</html>
